<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<link rel="stylesheet" href="/css/index.css" />
<link rel="stylesheet" href="/css/commons/common.css" />
<link rel="stylesheet" href="/css/commons/reset.css" />
<th:block th:insert="~{/layout/sideMenu :: head}" />
<style type="text/css">
</style>
<script type="text/javascript"
	src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/fullcalendar@6.0.2/index.global.min.js"></script>
<script src="/js/index/indexcalendar.js"></script>
<!-- 230111 출퇴근시간 스크립트 시작 안나 -->
<script type="text/javascript">
	$(function() {

		/* 시, 분 얻어오기 */
		var now = new Date();
		var hours = now.getHours(); // 시 얻어오기
		var minutes = now.getMinutes(); // 분 얻어오기

		/* 시, 분 한 자리수면 앞에 0 붙여주기 */
		hours = resetPlusZero(hours);
		minutes = resetPlusZero(minutes);
		function resetPlusZero(i) {
			if (i < 10) {
				i = "0" + i
			};
			return i;
		}
		
		/* status값 얻어오기 */
		var status = $('#status').val();
		console.log("status: " + status);

		/* 근무중일 때만 나오는 버튼들 */
		$("#start-time-today").hide(); //출근시간
		$("#end-time-today").hide(); //퇴근시간
		if (status == '근무중') {
			$("#start-time-today").show();
		}
		if (status == '근무종료'){
			$("#start-time-today").show();
			$("#end-time-today").show();
		}

		/* 출근 버튼 클릭 시 시작*/
		$("#start-time").click(function() {					
			if (status == '근무중' || status =='근무종료') { //미출근시에만 출근가능하도록
				alert("이미 출근하였습니다.");
			} else { //출근기록이 없으면 */
				
				// 출근 버튼 누르면 나오는 팝업창
				var startResult = confirm("현재 시각은 " + hours
						+ "시 " + minutes + "분입니다. \n출근하시겠습니까?");
			
				//출근 data 통신
				if (startResult) {
					$.ajax({
						async : false,
						type : "post",
						url : "/attendance/in",
						contentType : "application/x-www-form-urlencoded; charset=utf-8",
						dataType : "text",
						success : function(data) {
							console.log("성공 data:"
									+ data);
							if (data == "attinSuccess") { //데이터 리턴이 잘 됐으면
								alert("출근완료");
								location.reload(); //출근 완료 시 새로고침하여 출근기록 보이기
							} else {
								alert("이상발생");
							}
						},
						error : function() {
							console.log("실패");
						}
					})
				} else {
					alert("취소하였습니다."); // confirm창 취소 시 알림
				}
			}//출근기록 if else문 끝 */
		});
		/* 출근 버튼 클릭 시 끝*/
		
		/* 퇴근 버튼 클릭 시 시작*/
		$("#end-time").click(function() {
			if (status == null || status == '미출근') { //퇴근 조건
				alert("출근 후 퇴근 가능합니다.");
			} else{
				// 퇴근 버튼 누르면 나오는 팝업창
				var endResult = confirm("현재 시각은 " + hours + "시 "
						+ minutes + "분입니다. \n퇴근하시겠습니까?");

				//퇴근 data 통신
				if (endResult) {
					$.ajax({
						async : false,
						type : "patch",
						url : "/attendance/out",
						contentType : "application/json-patch+json; charset=utf-8",
						dataType : "text",
						success : function(data) {
							console.log("성공 data:" + data);
							if (data == "attoutSuccess") { //데이터 리턴이 잘 됐으면
								alert("퇴근완료");
								location.reload(); //새로고침
							} else {
								alert("이상발생");
							}
						},
						error : function() {
							console.log("실패");
						}
					});
				} else {
					alert("취소하였습니다."); // confirm창 취소 시 알림
				} // endResult if문 끝
			}//퇴근조건 if문 끝		
		}); //퇴근버튼 클릭 끝
	});//function 끝
</script>
<!-- 230111 출퇴근시간 스크립트 끝 안나 -->
</head>
<body>
	<th:block th:insert="~{/layout/sideMenu :: header}" />
	<section class="flex">
		<div>
			<section id="attendance">
				<!-- 230111 출퇴근버튼 시작 안나 230120 수정 안나 -->
				<div class="flex around">
					<button id="start-time">출근</button>
					<button id="end-time">퇴근</button>
				</div>
				<div sec:authorize="isAuthenticated()" id="clock-in-out"
					th:each="dto:${list}" class="flex around">
					<div>
						<p>출근시간 :</p>
						<input id="status" type="hidden" th:value="${dto.status}">
						<p id="start-time-today" th:text="${#temporals.format(dto.clockIn, 'HH:mm:SS')}"></p>
					</div>
					<div>
						<p>퇴근시간 :</p>
						<p id="end-time-today" th:text="${#temporals.format(dto.clockOut, 'HH:mm:SS')}"></p>
					</div>

				</div>
				<!-- 230111 출퇴근버튼 끝 안나 -->
			</section>
			<section id="calendar">
				<!-- 230111 문대현 -->
				<!-- calendar 태그 -->
				<div id='calendar-container'>
					<div id='calendar' style="width: 320px"></div>
				</div>
			</section>
		</div>
		<div>
			<section id="schedule" class="counting-list">
				<!-- 금일일정 -->
				<p class="sybtitle" onclick="gotoTodaySchedule()">금일 일정</p>
				<input type="hidden" th:value="${today}" id="today">
				<table id="list" class="list-table">
					<tr class="list-2">
						<th>번호</th>
						<th>종류</th>
						<th>상세내용</th>
					</tr>
					<tr th:if="${todaySchedule.isEmpty()}">
						<td colspan="3">오늘 일정이 없습니다</td>
					</tr>
					<tr th:if="${not #strings.isEmpty(todaySchedule)}" class="list-2"
						th:each="todaySchedule : ${todaySchedule}">
						<th class="counting-num">
							<!-- 글번호 -->
						</th>
						<th th:text="${todaySchedule.scheduleName}">[종류]</th>
						<th th:text="${todaySchedule.title}">[상세내용]</th>
					</tr>
				</table>
			</section>
			<section id="tomorrowSchedule" class="counting-list">
				<!-- 내일일정 -->
				<p class="subtitle" onclick="gotoTomorrowSchedule()">익일 일정</p>
				<input type="hidden" th:value="${tomorrow}" id="tomorrowDate">
				<script type="text/javascript">
					function gotoTomorrowSchedule() {
						var date = $("#tomorrowDate").val() + "";
						window.location.href = "/scheduleList?clickedDate="
								+ date;
					};
					function gotoTodaySchedule() {
						var date = $("#today").val() + "";
						window.location.href = "/scheduleList?clickedDate="
								+ date;
					};
					function selectNotice() {
						var select = "공지사항";
						indexBoard(select);
					}
					function selectCNC() {
						var select = "경조사";
						indexBoard(select);
					}
					function selectsuggest() {
						var select = "건의사항";
						indexBoard(select);
					}
					function indexBoard(selectBoard) {
						$.ajax({
							url : "/indexboard?select=" + selectBoard,
							success : function(result) {
								$("#indexBoardShow").html(result);
							}
						})
					}
				</script>
				<table id="list" class="list-table">
					<tr class="list-2">
						<th>번호</th>
						<th>종류</th>
						<th>상세내용</th>
					</tr>
					<tr th:if="${tomorrowSchedule.isEmpty()}">
						<td colspan="3">내일 일정이 없습니다</td>
					</tr>
					<tr th:if="${not #strings.isEmpty(tomorrowSchedule)}"
						class="list-2" th:each="tomorrowSchedule : ${tomorrowSchedule}">
						<th class="counting-num">
							<!-- 글번호 -->
						</th>
						<th th:text="${tomorrowSchedule.scheduleName}">[종류]</th>
						<th th:text="${tomorrowSchedule.title}">[상세내용]</th>
					</tr>
				</table>
			</section>
		</div>
		<div>
			<section id="approval"></section>
		</div>
	</section>
	<section class="flex">
		<section id="boards">
			<div class="flex">
				<button type="button" onclick="selectNotice()">공지사항</button>
				<button type="button" onclick="selectCNC()">경조사</button>
				<button type="button" onclick="selectsuggest()">건의사항</button>
			</div>
			<section id="indexBoardShow">
				<!-- 게시글 보여줄 곳 -->
			</section>
		</section>
		<section id="exchange">
			<p th:text="${today}+'의 환율'">오늘자 환율</p>
			<div class="flex between">
				<iframe
					src="https://sbiz.wooribank.com/biz/Dream?withyou=FXCNT0002&rc=0&divType=1&lang=KOR"
					frameBorder=0 width="210px" scrolling=no height=184 topmargin="0"
					name=irate marginWidth=0 marginHeight=0 title="무료환율표A형"></iframe>
				<iframe
					src="https://sbiz.wooribank.com/biz/Dream?withyou=FXCNT0006&rc=0&divType=1&lang=KOR"
					frameBorder=0 width="210px" scrolling=no height=184 topmargin="0"
					name=irate marginWidth=0 marginHeight=0 title="무료환율표A형"></iframe>
				<iframe
					src="https://sbiz.wooribank.com/biz/Dream?withyou=FXCNT0002&rc=0&divType=6&lang=KOR"
					frameBorder=0 width="210px" scrolling=no height=184 topmargin="0"
					name=irate marginWidth=0 marginHeight=0 title="무료환율표A형"></iframe>

			</div>
			<iframe
				src="https://sbiz.wooribank.com/biz/Dream?withyou=FXCNT0007&rc=0&divType=1&lang=KOR"
				frameBorder=0 width=600 scrolling=no height=184 topmargin="0"
				name=irate marginWidth=0 marginHeight=0 title="무료환율표A형"></iframe>
		</section>
	</section>
	<section class="flex">
		<section id="newEmp">
			<!-- 신입사원 -->
			신입사원
		</section>
		<section id="awardEmp">
			<!-- 우수사원 -->
			우수사원
		</section>
	</section>
</body>
</html>